<polymer-element name="google-images" attributes="query">
  <template>
    <style>
      :host {
        display: inline-block;
      }
      #container {
        width: 100%;
        height: 100%;
        overflow: auto;
        position: relative;
      }
    </style>
    <div id="container">
      <template repeat="{{result in results}}">
        <img style="width:100%;" src="{{result.url}}" onerror="(navigator.userAgent.toLowerCase().indexOf('firefox') === -1) && this.parentNode.removeChild(this);">
      </template>
    </div>
  </template>
  <script defer src="../SmartComposition/xhrq.js"></script>
  <script>
    Polymer({
      isSmartComponent: true,
      isInteractive: true,
      publish: {
        query: { reflect: true },
        results: { presetable: true }
      },
      queryChanged: function() {
        var _this = this;
        window.xhrq.get('https://ajax.googleapis.com/ajax/services/search/images?v=1.0', function(data) {
          _this.results = data.responseData && data.responseData.results || [];
        }, { q: this.query }, 'json');
      },
      created: function() {
        this._pubsub_subscribe('image', this.queryReceived);
      },
      queryReceived: function(message) {
        if (typeof message.data === 'string') this.query = message.data;
      }
    });
  </script>
</polymer-element>