<dom-module id="campus-plan">
  <style>
    :host {
      display: inline-block;
    }
    img {
      width: 100%;
      height: 100%;
    }
  </style>
  <template>
    <img src$="{{roomImageUrl}}">
  </template>
</dom-module>

<script defer src="../SmartComposition/xhrq.js"></script>

<script>
  Polymer({
    is: 'campus-plan',
    isSmartComponent: true,
    properties: {
      room: {
        type: String,
        notify: true,
        reflectToAttribute: true,
        observer: 'roomChanged'
      }
    },
    attached: function() {
      this._subscribe('room', this.roomReceived);
    },
    detached: function() {
      this._unsubscribe('room', this.roomReceived);
    },
    roomChanged: function() {
      this.getRoomImage();
    },
    getRoomImage: function() {
      var _this = this;
      window.xhrq.get('https://www.tu-chemnitz.de/tu/lageplan/campusfinder/campusfinder2014.php?raum=' + this.room, function(data) {
        var p = data.substr(data.lastIndexOf('kartezeichnen.php?'));
        _this.roomImageUrl = 'https://www.tu-chemnitz.de/tu/lageplan/campusfinder/' + p.substr(0, p.indexOf('"'));
      });
    },
    roomReceived: function(message) {
      if (typeof message.data === 'string') this.room = message.data;
    }

  });
</script>